(ns pimotor.core
  (import [com.pi4j.wiringpi Gpio]
          [com.pi4j.io.gpio GpioFactory RaspiPin PinState])

(def gpio (GpioFactory/getInstance))

(def motor-pins {1 {:enable RaspiPin/GPIO_26 :forward RaspiPin/GPIO_10 :reverse RaspiPin/GPIO_11}
                 2 {:enable RaspiPin/GPIO_12 :forward RaspiPin/GPIO_13 :reverse RaspiPin/GPIO_14}
		 3 {:enable RaspiPin/GPIO_06 :forward RaspiPin/GPIO_04 :reverse RaspiPin/GPIO_05}
		 4 {:enable RaspiPin/GPIO_00 :forward RaspiPin/GPIO_03 :reverse RaspiPin/GPIO_02}}
		 
(def arrow-pins {1 RaspiPin/GPIO_23
                 2 RaspiPin/GPIO_24
	         3 RaspiPin/GPIO_25
	         4 RaspiPin/GPIO_27})

(def motors (atom nil))
(def arrows (atom nil))



(defn make-arrow "Create an arrow with an id of 1-4."
  [id]
  (swap! arrows assoc id (.provisionDigitalOutputPin gpio (get arrow-pins id) (str "Arrow" id) PinState/LOW))

(defn arrow-on "Lights up an arrow by id."
  [id] (.high (get arrows id))

(defn arrow-off "Turns off an arrow by id."
  [id] (.low (get arrows id))
